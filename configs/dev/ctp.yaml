# CONFIG DOC
# Purpose: 开发环境 CTP 运行配置（仿真）。
# Consumer: core_engine / CtpConfigLoader
# Field dictionary: docs/ops/config_catalog.md (`configs/dev/ctp.yaml`)
# Notes:
#   1) 生产凭据不要写入仓库，优先使用环境变量占位符。
#   2) strategy_factory=composite 时必须同时设置 strategy_composite_config。

ctp:
  # --- identity & runtime mode ---
  profile: "dev"
  environment: sim
  run_type: sim
  is_production_mode: false
  enable_real_api: false

  # --- connection & auth ---
  broker_id: "${CTP_DEV_BROKER_ID}"
  user_id: "${CTP_DEV_USER_ID}"
  investor_id: "${CTP_DEV_INVESTOR_ID}"
  market_front: "${CTP_DEV_MARKET_FRONT}"
  trader_front: "${CTP_DEV_TRADER_FRONT}"

  password: "${CTP_DEV_PASSWORD}"
  auth_code: "${CTP_DEV_AUTH_CODE}"
  app_id: "${CTP_DEV_APP_ID}"

  # --- rate limit & retries ---
  query_rate_limit_qps: 10
  query_rate_per_sec: 5
  order_insert_rate_per_sec: 50
  order_cancel_rate_per_sec: 50
  order_bucket_capacity: 20
  cancel_bucket_capacity: 20
  query_bucket_capacity: 5
  cancel_retry_max: 3
  cancel_retry_base_ms: 1000
  cancel_retry_max_delay_ms: 5000
  cancel_wait_ack_timeout_ms: 1200
  settlement_confirm_required: true

  # --- observability & breaker ---
  metrics_enabled: false
  metrics_port: 8080
  log_level: "info"
  log_sink: "stderr"
  breaker_failure_threshold: 5
  breaker_timeout_ms: 1000
  breaker_half_open_timeout_ms: 5000
  breaker_strategy_enabled: true
  breaker_account_enabled: true
  breaker_system_enabled: true
  recovery_quiet_period_ms: 3000

  # --- storage & audit ---
  kafka_bootstrap_servers: "${KAFKA_BOOTSTRAP_SERVERS}"
  kafka_topic_ticks: "market.ticks.v1"
  clickhouse_dsn: "${CLICKHOUSE_DSN}"
  audit_hot_days: 7
  audit_cold_days: 180

  # --- strategy factory ---
  strategy_factory: "demo"
  # strategy_composite_config: "../strategies/composite_strategy.yaml"  # required when strategy_factory=composite
  connect_timeout_ms: 10000
  reconnect_max_attempts: 8
  reconnect_initial_backoff_ms: 500
  reconnect_max_backoff_ms: 8000

  # market_state_detector.* nested keys take precedence over legacy flat keys.
  market_state_detector:
    adx_period: 14
    adx_strong_threshold: 40.0
    adx_weak_lower: 25.0
    adx_weak_upper: 40.0
    kama_er_period: 10
    kama_fast_period: 2
    kama_slow_period: 30
    kama_er_strong: 0.6
    kama_er_weak_lower: 0.3
    atr_period: 14
    atr_flat_ratio: 0.001
    require_adx_for_trend: true
    use_kama_er: true
    min_bars_for_flat: 20
