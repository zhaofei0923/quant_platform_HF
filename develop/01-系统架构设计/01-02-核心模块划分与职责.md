# 核心模块划分与职责

## 对齐信息

- 对齐基线：main@17f0f8c957a4c0f95ebb054725f04b21e0e6861b
- 实现状态：部分落地
- 证据路径：`include/quant_hft/interfaces/`、`src/services/`、`src/core/`、`src/apps/core_engine_main.cpp`
- 最后更新：2026-02-11

## 当前实现边界

本文件保留“目标模块划分”设计价值，但以下仅代表当前已落地模块：
- 接口层：`include/quant_hft/interfaces/*`
- 核心层：`src/core/ctp`、`src/core/storage`、`src/core/regulatory`、`src/core/common`
- 服务层：`src/services/risk`、`src/services/order`、`src/services/market_state`、`src/services/portfolio`
- 应用层：`src/apps/core_engine_main.cpp`

## 当前模块职责（已落地）

### 1. 接口与合约

- `contracts/types.h`：统一交易与状态对象。
- `interfaces/*`：行情网关、订单网关、风控、缓存、时序、账本等抽象接口。

### 2. core 组件

- CTP：`ctp_config_loader`、`ctp_gateway_adapter`、`query_scheduler`。
- 存储：`redis_realtime_store*`、`timescale_event_store*`、`storage_client_factory`、`storage_client_pool`。
- 公共：`strategy_intent_codec`、`strategy_intent_inbox`。
- 合规：`local_wal_regulatory_sink`、`wal_replay_loader`。

### 3. services 组件

- 风控：`BasicRiskEngine`。
- 订单：`OrderStateMachine`、`InMemoryOrderGateway`。
- 状态：`RuleMarketStateEngine`。
- 账本：`InMemoryPortfolioLedger`。

## 规划内容（未落地）

1. 更细粒度风险规则引擎与策略化执行框架。
2. 更完整的策略生命周期管理与权限隔离。
3. 生产级统一观测与自动化运维控制面。

## 落地依赖条件

- 先稳定模块边界：接口字段、错误语义、配置键。
- 新模块必须先给出最小可测接口与回归方案。
- 保持 C++/Python 合约兼容，避免并行演进导致断裂。

## 进入实现阶段触发条件

- 需求能映射到具体目录与类，不再停留在抽象名词。
- 至少提供一条可自动验证的验收链路。
- 更新 `develop/00-实现对齐矩阵与缺口总览.md` 后再落地代码。
