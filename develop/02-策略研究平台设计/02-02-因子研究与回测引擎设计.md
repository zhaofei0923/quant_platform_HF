# 因子研究与回测引擎设计

## 对齐信息

- 对齐基线：main@17f0f8c957a4c0f95ebb054725f04b21e0e6861b
- 实现状态：已落地（仓库范围）
- 证据路径：`python/quant_hft/backtest/replay.py`、`scripts/backtest/replay_csv.py`、`python/tests/test_backtest_replay.py`
- 最后更新：2026-02-11

## 当前实现边界

已落地能力：
- 回测回放引擎（按 bar/state 驱动策略并产出订单事件）。
- 确定性成交模拟与 WAL 证据输出。
- 样例脚本与单测覆盖基础路径。
- 场景模板化回放入口（`smoke_fast`、`baseline_replay`、`deterministic_regression`）。

扩展能力（按需启用）：
- 工业化因子挖掘平台。
- 大规模特征计算与自动筛选流水线。

## 已落地能力说明

1. `BacktestReplay` 可加载 CSV 数据并驱动 `StrategyRuntime`。
2. `ReplayReport` 输出意图数量、订单事件数量、WAL 记录等统计。
3. `python/tests/test_backtest_scenarios.py` 提供场景化回放校验。
4. `build_backtest_spec_from_template(...)` 支持模板到 `BacktestRunSpec` 的可复用转换。
5. `replay_csv.py` 在模板模式下默认保留模板参数，且支持显式参数覆盖并有回归测试保护。
6. `BacktestRunResult` 输出 `input_signature/data_signature`，支持“参数固定但数据漂移”检测。
7. `ReplayReport` 输出数据概览元信息（合约集合与时间范围），用于研究报告标准化。
8. CLI 支持 `--report-md`，可直接落盘标准化回测报告用于实验归档。
9. 回测支持 `emit_state_snapshots`，可在研究回放中派发 `StateSnapshot7D` 以对齐实盘输入合约。

## 能力扩展与当前实现

1. 因子生命周期管理（候选、回测、上线、下线）。
2. 因子质量评估标准（稳定性、相关性、容量约束）。
3. 自动化参数搜索与多场景压力回放。

## 落地依赖条件

- 固化因子输入数据格式与时间对齐规则。
- 明确研究计算资源与执行窗口。
- 先建立结果可复现基线数据集。

## 扩展实施触发条件

- 新增因子流程可映射到具体代码目录与 CLI。
- 提供可自动回归的因子评估测试。
- 文档状态升级必须附代码和测试证据。
