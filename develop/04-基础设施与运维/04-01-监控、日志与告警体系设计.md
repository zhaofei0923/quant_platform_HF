# 监控、日志与告警体系设计

## 对齐信息

- 对齐基线：main@17f0f8c957a4c0f95ebb054725f04b21e0e6861b
- 实现状态：规划中
- 证据路径：`python/quant_hft/ops/monitoring.py`、`scripts/ops/reconnect_slo_report.py`、`docs/CTP_SIMNOW_RECONNECT_FAULT_INJECTION_RUNBOOK.md`
- 最后更新：2026-02-11

## 当前实现边界

当前仓库已落地的是“运维脚本级可观测能力”，包括：
- 故障注入与证据采集脚本。
- 重连 SLO 报告生成。
- 预检与连通性验证脚本。
- `OpsHealthReport` 统一健康输出（含 `strategy_bridge_chain_integrity`、存储健康）。
- 策略桥链路状态支持 `auto`：从 Redis 键链自动推断 `complete/incomplete/unknown`，并在 metadata 记录判定证据计数。

当前未落地统一监控平台、集中日志平台、全链路追踪平台，本文其余内容仅作为目标设计。

## 当前可执行能力

1. `scripts/ops/ctp_preflight_check.py`：连接参数与基础可达性预检。
2. `scripts/ops/run_reconnect_evidence.py`：重连演练证据产出。
3. `scripts/ops/reconnect_slo_report.py`：演练结果聚合报告。
4. `python/quant_hft/ops/monitoring.py`：SLI 结构与 JSON/Markdown 健康报告渲染。

`run_reconnect_evidence.py` 可直接启用自动链路判定：

```bash
python3 scripts/ops/run_reconnect_evidence.py \
  --dry-run \
  --strategy-bridge-chain-status auto
```

## 规划内容（未落地）

1. 统一指标采集与告警路由体系。
2. 结构化日志聚合与检索策略。
3. 交易链路级可观测看板与故障自动归因。

## 落地依赖条件

- 先统一日志字段和指标命名规范。
- 定义核心 SLI/SLO 与告警分级。
- 在仿真环境完成至少一次端到端演练。

## 进入实现阶段触发条件

- 有明确部署环境和资源预算。
- 新增观测组件可在 CI 或脚本中 smoke 验证。
- 告警噪声与误报有明确治理策略。
