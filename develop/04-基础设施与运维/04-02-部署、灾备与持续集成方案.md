# 部署、灾备与持续集成方案

## 对齐信息

- 对齐基线：main@f1f98c884be1538c06acff265f2904745175be96
- 实现状态：已落地（仓库范围）
- 证据路径：`.github/workflows/ci.yml`、`scripts/build/bootstrap.sh`、`scripts/build/package_nonhotpath_release.sh`、`scripts/build/run_consistency_gates.sh`、`scripts/build/run_preprod_rehearsal_gate.sh`、`scripts/ops/run_v3_acceptance.sh`、`scripts/infra/bootstrap_prodlike.sh`、`scripts/infra/bootstrap_prodlike_multi_host.sh`
- 最后更新：2026-02-17

## 当前实现边界

已落地：
- CI 流程：纯 C++ 构建、测试、一致性与演练门禁。
- 发布流程：`package_nonhotpath_release.sh` 打包与产物清单。
- 预发演练：`run_preprod_rehearsal_gate.sh` 产出 cutover/rollback 证据。
- 生产验收：`run_v3_acceptance.sh` 进行关键链路验收。
- 基础设施入口：`bootstrap_prodlike.sh`、`bootstrap_prodlike_multi_host.sh`。

## 当前可执行流程

1. 本地或 CI 全量验证：`./scripts/build/bootstrap.sh`
2. 一致性门禁：`bash scripts/build/run_consistency_gates.sh --build-dir build --results-dir docs/results`
3. 预发演练门禁：`bash scripts/build/run_preprod_rehearsal_gate.sh --build-dir build --results-dir docs/results`
4. v3 验收：`bash scripts/ops/run_v3_acceptance.sh --build-dir build`
5. 发布打包：`bash scripts/build/package_nonhotpath_release.sh v1.0.0`
6. 单机基础设施自建：`bash scripts/infra/bootstrap_prodlike.sh --execute --action up`
7. 多机基础设施演练：`bash scripts/infra/bootstrap_prodlike_multi_host.sh --dry-run --action up --output-file docs/results/prodlike_multi_host_bootstrap_result.env`

## 生产阶段方案（执行顺序）

1. 阶段 A：单机生产基线（当前）
   - 验收：发布、回滚、恢复、证据归档流程可重复执行。
2. 阶段 B：多机主备演练（持续增强）
   - 验收：主备切换可演练，恢复时限可量化。

## 落地依赖条件

- 发布包结构与版本命名规范冻结。
- 环境配置注入与密钥管理方式明确。
- 关键恢复链路有固定演练窗口与阈值策略。
