# 环境搭建与快速开始

## 对齐信息

- 对齐基线：main@f1f98c884be1538c06acff265f2904745175be96
- 实现状态：已落地
- 证据路径：`scripts/build/bootstrap.sh`、`src/apps/core_engine_main.cpp`、`src/apps/backtest_cli_main.cpp`
- 最后更新：2026-02-17

## 概述

本文档给出从零到“可构建、可运行、可验证”的最短路径（纯 C++）。

## 1. 环境要求

- OS：Ubuntu 22.04 LTS（建议）
- CMake：>= 3.20
- 编译器：GCC >= 11 或 Clang >= 14

Ubuntu 依赖示例：

```bash
sudo apt-get update
sudo apt-get install -y build-essential cmake git pkg-config
```

## 2. 一键构建与自测（推荐）

```bash
./scripts/build/bootstrap.sh
```

脚本会执行：
- CMake 配置、编译、`ctest`
- 性能/一致性/预发演练门禁
- 合约与 develop 文档校验
- 仓库纯度检查

## 3. 手动构建 C++

```bash
cmake -S . -B build -DQUANT_HFT_BUILD_TESTS=ON
cmake --build build -j$(nproc)
ctest --test-dir build --output-on-failure
```

## 4. 运行核心进程（core_engine）

```bash
export CTP_SIM_PASSWORD='your_password'
./build/core_engine configs/sim/ctp.yaml
```

可选连通性探针：

```bash
./build/simnow_probe configs/sim/ctp_trading_hours.yaml
```

## 5. 回测与研究 CLI

```bash
./build/backtest_cli --engine_mode csv --csv_path backtest_data/rb.csv --max_ticks 5000 --output_json docs/results/backtest_cli_smoke.json --output_md docs/results/backtest_cli_smoke.md
./build/factor_eval_cli --help
./build/backtest_benchmark_cli --runs 5 --baseline_p95_ms 100 --result_json docs/results/backtest_benchmark_result.json
```

## 6. 运维证据链 CLI

```bash
./build/reconnect_evidence_cli --report_file docs/results/reconnect_fault_result.md --health_json_file docs/results/ops_health_report.json --health_markdown_file docs/results/ops_health_report.md --alert_json_file docs/results/ops_alert_report.json --alert_markdown_file docs/results/ops_alert_report.md
./build/ctp_cutover_orchestrator_cli --help
```

## 7. 常用门禁命令

```bash
bash scripts/build/dependency_audit.sh --build-dir build
bash scripts/build/repo_purity_check.sh --repo-root .
./build/verify_contract_sync_cli
./build/verify_develop_requirements_cli
```
