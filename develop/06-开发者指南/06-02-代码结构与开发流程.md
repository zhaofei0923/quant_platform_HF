# 代码结构与开发流程

## 对齐信息

- 对齐基线：main@f1f98c884be1538c06acff265f2904745175be96
- 实现状态：已落地
- 证据路径：`src/`、`include/`、`scripts/`、`.github/workflows/ci.yml`
- 最后更新：2026-02-17

## 概述

本文档提供仓库目录结构、构建测试入口和推荐开发流程（纯 C++）。

## 1. 仓库目录结构

```
quant_platform_HF/
├── src/                  # C++ 实现
│   ├── core/             # 核心组件（ctp/storage/regulatory/common）
│   ├── services/         # 领域服务（risk/order/portfolio/market_state）
│   ├── strategy/         # 策略运行时（registry/engine/demo）
│   └── apps/             # CLI 与主进程入口
├── include/quant_hft/    # 公共头文件与接口
├── scripts/              # Shell 工具入口（build/infra/ops）
├── configs/              # 运行配置
├── proto/                # 合约定义
├── tests/unit/           # C++ 单元测试（GTest）
├── docs/                 # runbook/验收/进度
└── develop/              # 设计与开发文档
```

## 2. 构建、测试与质量门禁

### 2.1 一键入口（推荐）

```bash
./scripts/build/bootstrap.sh
```

### 2.2 手动构建与测试

```bash
cmake -S . -B build -DQUANT_HFT_BUILD_TESTS=ON
cmake --build build -j$(nproc)
ctest --test-dir build --output-on-failure
```

### 2.3 质量门禁

```bash
bash scripts/build/dependency_audit.sh --build-dir build
bash scripts/build/run_consistency_gates.sh --build-dir build --results-dir docs/results
bash scripts/build/run_preprod_rehearsal_gate.sh --build-dir build --results-dir docs/results
bash scripts/build/repo_purity_check.sh --repo-root .
bash scripts/build/doc_purity_check.sh --repo-root .
./build/verify_contract_sync_cli
./build/verify_develop_requirements_cli
```

## 3. 建议开发流程

1. 小步提交：每次只做一类问题。
2. 先测后改：先补测试再改实现。
3. 同步文档：涉及接口与流程变更时更新 `develop/` 与 `docs/`。
4. 提交前至少跑一次 `./scripts/build/bootstrap.sh`。

## 4. 常用定位命令

```bash
rg -n "StrategyEngine" -S src include tests
rg --files | rg "^develop/"
rg --files | rg "^docs/"
```
