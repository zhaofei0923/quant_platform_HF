# 系统部署手册

## 对齐信息

- 对齐基线：main@17f0f8c957a4c0f95ebb054725f04b21e0e6861b
- 实现状态：已落地
- 证据路径：`docs/SYSTEMD_DEPLOYMENT_RUNBOOK.md`、`docs/K8S_DEPLOYMENT_RUNBOOK.md`、`scripts/ops/render_systemd_units.py`
- 最后更新：2026-02-11

## 概述

本文档说明本仓库当前可用的部署方式与交付物范围。

当前落地的部署单元：
- `core_engine`（C++ 可执行文件）
- `data_pipeline`（Python 进程，导出与归档数据）

更详细步骤请直接参考仓库 runbook：
- systemd：`docs/SYSTEMD_DEPLOYMENT_RUNBOOK.md`
- Kubernetes（非热路径）：`docs/K8S_DEPLOYMENT_RUNBOOK.md`

## 1. 部署前准备

### 1.1 构建与验证

推荐在部署前执行：

```bash
./scripts/build/bootstrap.sh
```

### 1.2 配置文件

CTP 运行配置位于 `configs/`：
- `configs/sim/ctp.yaml`
- `configs/sim/ctp_trading_hours.yaml`
- `configs/dev/ctp.yaml`
- `configs/prod/ctp.yaml`

## 2. 单机运行（开发/验证）

```bash
export CTP_SIM_PASSWORD='your_password'
./build/core_engine configs/sim/ctp.yaml
```

可选：配置与网络预检：

```bash
.venv/bin/python scripts/ops/ctp_preflight_check.py --config configs/sim/ctp.yaml
```

## 3. systemd 部署（推荐）

本仓库提供 unit 渲染器：

```bash
.venv/bin/python scripts/ops/render_systemd_units.py \
  --repo-root . \
  --output-dir deploy/systemd \
  --service-user "$USER"
```

产物与安装步骤参见：`docs/SYSTEMD_DEPLOYMENT_RUNBOOK.md`。

## 4. Kubernetes 部署（非热路径组件）

当前 manifest bundle 仅覆盖 `data_pipeline`，渲染方式：

```bash
.venv/bin/python scripts/ops/render_k8s_manifests.py \
  --repo-root . \
  --output-dir deploy/k8s \
  --namespace quant-hft \
  --image-repository ghcr.io/<org>/quant-hft \
  --image-tag v0.1.0
```

应用与验证参见：`docs/K8S_DEPLOYMENT_RUNBOOK.md`。
