# 运维操作手册

## 对齐信息

- 对齐基线：main@f1f98c884be1538c06acff265f2904745175be96
- 实现状态：已落地（仓库范围）
- 证据路径：`src/apps/reconnect_evidence_cli_main.cpp`、`src/apps/ctp_cutover_orchestrator_cli_main.cpp`、`scripts/ops/run_v3_acceptance.sh`、`scripts/infra/bootstrap_prodlike.sh`、`docs/WAL_RECOVERY_RUNBOOK.md`
- 最后更新：2026-02-17

## 当前实现边界

当前仓库可直接执行的运维操作聚焦在：
- 单机/小规模环境验收。
- 重连、健康、告警证据输出。
- 切换与回滚演练证据归档。

## 现状 SOP（已落地，可执行）

### 1. 构建与基础验收

```bash
./scripts/build/bootstrap.sh
```

### 2. 重连演练与证据归档

```bash
./build/reconnect_evidence_cli \
  --report_file docs/results/reconnect_fault_result.md \
  --health_json_file docs/results/ops_health_report.json \
  --health_markdown_file docs/results/ops_health_report.md \
  --alert_json_file docs/results/ops_alert_report.json \
  --alert_markdown_file docs/results/ops_alert_report.md
```

### 3. 切换与回滚演练

```bash
./build/ctp_cutover_orchestrator_cli --help
```

### 4. WAL 恢复参考

- 执行步骤：`docs/WAL_RECOVERY_RUNBOOK.md`
- 证据模板：`docs/templates/WAL_RECOVERY_RESULT.md`

### 5. 单机生产环境验收（当前）

```bash
bash scripts/infra/bootstrap_prodlike.sh --execute --action up
bash scripts/ops/run_v3_acceptance.sh --build-dir build
```

### 6. 多机主备演练（仓库范围）

```bash
bash scripts/infra/bootstrap_prodlike_multi_host.sh --dry-run --action up --output-file docs/results/prodlike_multi_host_bootstrap_result.env
```

## 扩展 SOP（可选）

以下内容作为后续增强方向维护：
- 大规模集群统一编排。
- 跨区域灾备与多活治理。
- 自动化故障归因与自愈。
