# 测试策略与验证方案

## 对齐信息

- 对齐基线：main@f1f98c884be1538c06acff265f2904745175be96
- 实现状态：已落地
- 证据路径：`tests/unit/`、`scripts/build/bootstrap.sh`、`.github/workflows/ci.yml`
- 最后更新：2026-02-17

## 概述

本文档描述当前纯 C++ 测试与质量门禁，以及新增测试的推荐位置与执行方式。

## 1. 测试入口（推荐）

```bash
./scripts/build/bootstrap.sh
```

脚本会执行：
- C++ 构建与 `ctest`
- 依赖审计、回测一致性、预发演练门禁
- 合约同步与 develop 文档校验
- 仓库纯度校验

## 2. C++ 单元测试

### 2.1 测试目录

- `tests/unit/core/*`：core 组件单测
- `tests/unit/services/*`：services 组件单测
- `tests/unit/strategy/*`：策略层单测
- `tests/unit/apps/*`：CLI 与编排层单测

### 2.2 运行方式

```bash
cmake -S . -B build -DQUANT_HFT_BUILD_TESTS=ON
cmake --build build -j$(nproc)
ctest --test-dir build --output-on-failure
```

## 3. 专项门禁

```bash
bash scripts/build/dependency_audit.sh --build-dir build
bash scripts/build/run_consistency_gates.sh --build-dir build --results-dir docs/results
bash scripts/build/run_preprod_rehearsal_gate.sh --build-dir build --results-dir docs/results
bash scripts/build/repo_purity_check.sh --repo-root .
bash scripts/build/doc_purity_check.sh --repo-root .
./build/verify_contract_sync_cli
./build/verify_develop_requirements_cli
```

## 4. CI 对齐

CI 以 `.github/workflows/ci.yml` 为准，核心门禁包括：
- C++ build/test
- consistency gate
- preprod rehearsal gate
- purity gate

## 5. 可选增强方向

- 大规模集成压测。
- 真实外部依赖的长时回放。
- 更细粒度性能阈值治理。
