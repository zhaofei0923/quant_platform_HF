# 测试策略与验证方案

## 对齐信息

- 对齐基线：main@17f0f8c957a4c0f95ebb054725f04b21e0e6861b
- 实现状态：已落地
- 证据路径：`tests/unit/`、`python/tests/`、`scripts/build/bootstrap.sh`
- 最后更新：2026-02-11

## 概述

本文档描述本仓库当前落地的测试与质量门禁，以及新增测试的推荐位置与执行方式。

当前落地范围以“可重复执行的单元测试 + CI 校验”为主。

## 1. 测试入口（推荐）

本仓库提供一键验证脚本：

```bash
./scripts/build/bootstrap.sh
```

脚本会执行：
- C++：cmake 配置/构建 + `ctest`
- Python：创建 `.venv` + `pip install -e ".[dev]"` + `ruff/black/mypy/pytest`

## 2. C++ 单元测试

### 2.1 测试目录

- `tests/unit/core/*`：core 组件单测
- `tests/unit/services/*`：services 组件单测

### 2.2 运行方式

```bash
cmake -S . -B build -DQUANT_HFT_BUILD_TESTS=ON
cmake --build build -j
ctest --test-dir build --output-on-failure
```

## 3. Python 单元测试

### 3.1 测试目录

- `python/tests/*`：pytest 单元测试

### 3.2 运行方式

```bash
python3 -m venv .venv
.venv/bin/pip install --upgrade pip
.venv/bin/pip install -e ".[dev]"

.venv/bin/pytest python/tests -q
```

## 4. 质量门禁（本地与 CI）

### 4.1 Python 质量门禁

```bash
.venv/bin/ruff check python scripts
.venv/bin/black --check python scripts
.venv/bin/mypy python/quant_hft
```

### 4.2 CI 对齐

CI 以 `.github/workflows/ci.yml` 为准，包含：
- C++ job：cmake/build/ctest
- Python job：ruff/black/mypy/pytest

## 5. 未来扩展（可选）

以下属于可选增强方向，当前仓库未作为默认门禁：
- 集成测试（跨模块/跨进程）
- 性能回归测试（基准与阈值）
- 静态分析（clang-tidy 等）
- 端到端演练（包含真实外部依赖）
